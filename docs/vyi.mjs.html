<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vyi.mjs - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Frame.html">Frame</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Frame.html#getDataURL">getDataURL</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Frame.html#getDelay">getDelay</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Frame.html#getHeight">getHeight</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Frame.html#getParent">getParent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Frame.html#getSize">getSize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Frame.html#getVyi">getVyi</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Frame.html#getWidth">getWidth</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Frame.html#setDataURL">setDataURL</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Frame.html#setDelay">setDelay</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Icon.html">Icon</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#addFrame">addFrame</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#addState">addState</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#getDataURL">getDataURL</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#getDelay">getDelay</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#getFrame">getFrame</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#getFrames">getFrames</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#getHeight">getHeight</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#getId">getId</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#getName">getName</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#getParent">getParent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#getSize">getSize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#getState">getState</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#getStates">getStates</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#getVyi">getVyi</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#getWidth">getWidth</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#parse">parse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#removeFrame">removeFrame</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#removeFrameByIndex">removeFrameByIndex</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#removeState">removeState</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#removeStateById">removeStateById</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#removeStateByName">removeStateByName</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#rename">rename</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#reorderFrame">reorderFrame</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#setAllFrameDelays">setAllFrameDelays</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#setDataURL">setDataURL</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#setDelay">setDelay</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Icon.html#setSize">setSize</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="VYI.html">VYI</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VYI.html#addIcon">addIcon</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VYI.html#export">export</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VYI.html#getIcon">getIcon</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VYI.html#getIconById">getIconById</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VYI.html#getIconNames">getIconNames</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VYI.html#getIcons">getIcons</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VYI.html#getName">getName</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VYI.html#parse">parse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VYI.html#removeIcon">removeIcon</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VYI.html#removeIconById">removeIconById</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VYI.html#removeIconByName">removeIconByName</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VYI.html#rename">rename</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">vyi.mjs</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { Logger } from './vendor/logger.mjs';
import { Icon } from './icon.mjs';
import { Frame } from './frame.mjs';
import pako from './vendor/pako.esm.mjs';

/**
 * @public
 */
class VYI {
	/**
	 * The version of the module.
	 */
	static version = "VERSION_REPLACE_ME";
    /** The logger module this module uses to log errors / logs.
     * @private
     * @type {Object}
     */
    static logger = new Logger();
    /**
     * A map of icons that belong to this VYI
     * @private
     * @type {Map}
     */
    icons = new Map();
    /**
     * The name of this vyi.
     * @private
     * @type {string}
     */
    name = 'failed-to-find-vyi-name';
    /**
     * The version of the VYI.
     * @private
     * @type {number}
     */
    formatVersion = 1;
    /**
     * Initializes this module with the information from the VYI passed.
     * @param {Object} pVyiData - A JSON / Javascript object containing the vyi information.this.ogger
    */
    constructor(pVyiData) {
        VYI.logger.registerType('Vyi-module', '#ff6600');
        this.parse(pVyiData);
    }
    /**
     * Parses the provided VYI data (either a URL, a JSON object, or binary data) and processes it.
     * If the data is a URL (string), it fetches/reads the data and parses it as JSON.
     * If the data is binary, it attempts to inflate it using pako or decode it as plain text.
     *
     * @param {string|Object|Uint8Array|ArrayBuffer} pVyiData - The VYI data to parse. Or a path to a VYI file.
     * @returns {Promise&lt;void>} - A promise that resolves when the parsing is completed.
     * @throws {Error} - Throws an error if fetching, inflating, or decoding fails.
     */
    async parse(pVyiData) {
        if (!pVyiData) return;

        try {
            let vyi;

            if (typeof pVyiData === 'string') {
                const isNodeEnv = typeof window === 'undefined';
                vyi = isNodeEnv 
                    ? await this.readFileAndGetVYI(pVyiData) 
                    : await this.fetchAndParseJSON(pVyiData);
            } else if (pVyiData instanceof VYI) {
                vyi = pVyiData.export();
            } else if (pVyiData instanceof Object &amp;&amp; !Array.isArray(pVyiData) &amp;&amp; !(pVyiData instanceof ArrayBuffer || pVyiData instanceof Uint8Array)) {
                vyi = pVyiData;
            } else if (pVyiData instanceof ArrayBuffer || pVyiData instanceof Uint8Array) {
                vyi = await this.handleBinaryData(pVyiData);
            } else {
                throw new Error('Error processing: Invalid input type provided.');
            }

            this.processVyiData(vyi);
        } catch (pError) {
            VYI.logger.prefix('Vyi-module').error(`${pError.message}`);
        }
    }
    /**
     * Reads a file and returns the vyi from it.
     * @private
     * @param {string} - The URL to read the data from.
     * @returns {Promise&lt;Object>} - The vyi from the file.
     */
    async readFileAndGetVYI(pURL) {
        const fs = (await import('fs')).promises;
        const data = await fs.readFile(pURL);
        return this.handleBinaryData(data);
    }
    /**
     * Fetches data from a URL and parses it as JSON.
     * @private
     * @param {string} pURL - The URL to fetch the data from.
     * @returns {Promise&lt;Object>} - A promise that resolves to the parsed JSON data.
     */
    async fetchAndParseJSON(pURL) {
        try {
            const response = await fetch(pURL);
            const jsonData = await response.json();
            return jsonData;
        } catch (pError) {
            throw new Error(`Failed to fetch or parse JSON from URL: ${pError}`);
        }
    }
    /**
     * Handles binary data (ArrayBuffer or Uint8Array). Attempts to inflate or decode it.
     * @private
     * @param {ArrayBuffer|Uint8Array} pBinaryData - The binary data to process.
     * @returns {Object|string|null} - The parsed JSON object or decoded string, or null if it fails.
     */
    handleBinaryData(pBinaryData) {
        const arrayBuffer = pBinaryData instanceof ArrayBuffer ? pBinaryData : pBinaryData.buffer;

        try {
            // Attempt to decompress the binary data
            const decompressed = pako.inflate(arrayBuffer, { to: 'string' });
            return JSON.parse(decompressed);
        } catch {
            // If decompression fails, decode it as plain text
            const decodedText = new TextDecoder().decode(arrayBuffer);
            return JSON.parse(decodedText);
        }
    }
    /**
     * Processes the parsed VYI data and adds icons to the VYI module instance.
     * @private
     * @param {Object} pVyi - The parsed VYI data.
     */
    processVyiData(pVyi) {
        const icons = pVyi.i;
        this.formatVersion = pVyi.v || 1;

        if (Array.isArray(icons)) {
            icons.forEach((pIconData) => {
                this.addIcon(pIconData, this);
            });
        } else {
            VYI.logger.prefix('Vyi-module').error('Invalid .vyi file! Cannot parse icons.');
        }
    }
    /**
     * Adds an icon to this VYI.
     * @param {Icon|Array} pIconData - The icon data to use.
     * @returns {Icon|undefined} - The Icon added or undefined.
     */
    addIcon(pIconData) {
        if (!pIconData) {
            VYI.logger.prefix('Vyi-module').error('No icon data passed!');
            return;
        }

        if (!(pIconData instanceof Icon) &amp;&amp; !Array.isArray(pIconData)) {
            VYI.logger.prefix('Vyi-module').error('Invalid icon data type passed!');
            return;
        }

        // Create the icon instance
        const icon = pIconData instanceof Icon
            ? pIconData
            : new Icon(pIconData);

        icon.setVyi(this);
        this.icons.set(icon.id, icon);
        return icon;
    }
    /**
     * Removes the icon passed.
     * @param {Icon} pIcon - The icon to remove from this vyi.
     */
    removeIcon(pIcon) {
        if (!pIcon) return;
        if (pIcon instanceof Icon) {
            if (this.icons.delete(pIcon.id)) {;
                pIcon.removeVyi();
            }
        }
    }
    /**
     * Removes the icon via it's name. The LAST defined icon that has the passed name will be removed. As names are not unique.
     * @param {string} pName - The name to use to find the icon.
     */
    removeIconByName(pName) {
        const icon = this.getIcon(pName);
        this.removeIcon(icon);
    }
    /**
     * Removes the icon via it's id.
     * @param {string} pName - The id to use to find the icon.
     */
    removeIconById(pId) {
        const icon = this.getIconById(pId);
        this.removeIcon(icon);
    }
    /**
     * Returns all the icon names in this vyi.
     * @returns {Array} An array of icon names in this vyi.
     */
    getIconNames() {
        const iconNames = this.getIcons().map((pIcon) => pIcon.name);
        return iconNames;
    }
    /**
     * Gets the icon that has the name pName. The LAST defined icon that has the passed name will be returned.
     * @param {string} pName - The name of the icon to get.
     * @returns {Icon|undefined} The icon that has the name pName or undefined.
     */
    getIcon(pName) {
        if (typeof pName === 'string') {
            const icons = this.getIcons();
            for (let i = icons.length - 1; i >= 0; i--) {
                const icon = icons[i];
                // If the icon has the same name, return that icon
                if (icon.getName() === pName) {
                    return icon;
                }
            }
        } else {
            VYI.logger.prefix('Vyi-module').error('Invalid name type used!');
        }
    }
    /**
     * Gets an icon by the id provided.
     * @param {string} pId - The id of the icon.
     * @returns {Icon} The icon that has the id that was passed.
     */
    getIconById(pId) {
        if (!pId) return;
        return this.icons.get(pId);
    }
    /**
     * Gets all the icons in this vyi.
     * @returns {Array&lt;Icon>}
     */
    getIcons() {
        return Array.from(this.icons.values());
    }
    /**
     * Renames the vyi.
     * @param {string} pName - The name to give this vyi.
     */
    rename(pName) {
        if (typeof pName === 'string') {
            this.name = pName;
        } else {
            VYI.logger.prefix('Vyi-module').error('Invalid name type used!');
        }
    }
    /**
     * Gets the name of the vyi.
     * @returns {string} The name of the vyi.
     */
    getName() {
        return this.name;
    }
    /**
     * Exports this VYI into VYI format.
     * @returns {Object} Returns the vyi data.
     */
    export() {
        const vyi = {};
        vyi.v = this.formatVersion;
        vyi.i = this.getIcons().map((pIcon) => pIcon.export());
        return vyi;
    }
}

export { VYI, Icon, Frame };</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.3</a> on Wed Sep 25 2024 15:51:20 GMT-0500 (Central Daylight Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
